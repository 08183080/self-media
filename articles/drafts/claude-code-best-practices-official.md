---
title: "Claude Code 最佳实践：把 AI 编程助手用到刀刃上"
author: "谢苹果"
summary: "基于 Claude Code 官方文档，提炼出几条被内部和外部工程师验证过的心法：先探索再编码、写好 CLAUDE.md、管好上下文、用好 subagents，以及如何避开常见失败模式。"
coverImage: "cover.png"
date: 2026-02-21
tags: []
---

# Claude Code 最佳实践：把 AI 编程助手用到刀刃上

> Claude Code 不是等你问一句答一句的聊天机器人，而是能读文件、跑命令、改代码的代理。但自主性再强，也有一条学习曲线——官方文档里总结的最佳实践，能帮你少踩坑、多省心。

---

## 一、最重要的约束：上下文会满

大多数最佳实践都绕不开一个事实：**Claude 的 context window 填得很快，填得越满，表现越差。**

对话里的每条消息、读过的每个文件、每条命令输出，都在占用上下文。一次调试或一次代码库探索，很容易就吃掉几万 token。当窗口快满时，模型会开始「忘掉」早先的指令、更容易出错。

所以有一条心法要刻在脑子里：**context window 是你最该省着用的资源。** 后面的技巧，很多都是为了在少占上下文的前提下，把事做对。

---

## 二、给它「验收标准」，别只给任务

当 Claude 能自己验证结果——跑测试、对比截图、检查输出——表现会明显更好。没有明确成功标准时，它可能写出「看起来对、跑起来错」的代码，而你成了唯一的反馈回路，每个错误都要你亲自指出来。

可以这样升级你的提示：

| 之前 | 之后 |
| --- | --- |
| 「实现一个验证邮箱的函数」 | 「写一个 validateEmail 函数。要求：user@example.com 为真，invalid 为假，user@.com 为假。实现后跑一遍这些用例。」 |
| 「让仪表板好看点」 | 「[贴设计图] 按这个实现。做完后截一张图跟原设计对比，列出差异并修掉。」 |
| 「构建挂了」 | 「构建报错：[贴错误]。请修好并确认构建通过。要解决根因，不要只把报错压下去。」 |

UI 改动可以配合浏览器里的 Claude 扩展做验证；后端逻辑就用测试、linter 或简单的 Bash 检查。**在「可验证」上多花一点心思，后面会省很多时间。**

---

## 三、先探索，再规划，最后再编码

一上来就写代码，很容易解决错问题。官方推荐用 **Plan Mode** 把「探索」和「执行」分开，流程大致是：

1. **探索**：理解代码库、依赖、现有模式；
2. **规划**：在不动代码的前提下，想清楚要改什么、怎么改；
3. **编码**：按规划一步步改。

这样能减少「写了一大段发现方向错了」的情况，也避免探索阶段读太多文件把上下文塞满。

---

## 四、提示里给足「具体上下文」

Claude 能推断意图，但不会读心。要说清：**哪个文件、什么场景、参考什么模式。**

- **限定范围**：不是「给 foo.py 加测试」，而是「给 foo.py 写测试，覆盖用户已登出的边界情况，尽量少用 mock」。
- **指向来源**：不是「ExecutionFactory 的 API 为啥这么怪」，而是「看 ExecutionFactory 的 git 历史，总结它的 API 是怎么演变成现在这样的」。
- **引用现有模式**：不是「加个日历组件」，而是「先看主页上现有组件的写法，以 HotDogWidget.php 为参考，按同样模式实现日历组件：选月份、前后翻页选年份，只用项目里已有的库」。
- **描述症状**：不是「登录有问题」，而是「用户反馈会话超时后登录失败。请检查 src/auth/ 下的认证流程，尤其是 token 刷新；先写一个能复现的失败测试，再修。」

拿不准时，可以用「@文件路径」直接引用文件，或贴截图、贴错误信息、贴日志。**信息越具体，一次做对的概率越高。**

---

## 五、写好 CLAUDE.md，等于给每次对话加「默认设定」

CLAUDE.md 是 Claude 每次对话都会读的特殊文件，适合写：**构建/测试命令、代码风格、工作流约定**——那些它光看代码很难猜出来的东西。用 `/init` 可以让 Claude 先分析一遍项目，生成一个初版，你再按需精简、补充。

原则是：**短、好读、只写删掉就会导致犯错的内容。**

- 要写：它猜不到的 Bash 命令、和默认不一致的代码风格、你偏好的测试方式、仓库礼仪、关键架构决策、环境变量和常见坑。
- 不要写：能从代码里看出来的东西、长篇教程、逐文件介绍、经常变动的信息。

如果 CLAUDE.md 已经很长，模型容易忽略后半部分。像维护代码一样维护它：出错时回头看、定期删冗余、用「IMPORTANT」「YOU MUST」标出真正不能违反的规则。还可以用 `@path/to/file` 把说明拆到别的文件里，保持主文件简短。

---

## 六、权限、沙箱和「少点打断」

默认情况下，写文件、跑命令、用 MCP 等操作都会问你同意。问多了就容易变成无脑点「允许」。可以：

- **权限白名单**：把确定安全的命令（如 `npm run lint`、`git commit`）加入白名单；
- **沙箱**：用系统级隔离限制文件系统和网络，让 Claude 在划定范围内自由执行；
- 对确定安全的流水线（如修 lint、生成样板），可以用 `--dangerously-skip-permissions` 跳过权限确认。

这样既保证安全，又减少无效打断。

---

## 七、Skills、Subagents、MCP：按需扩展

- **Skills**：把项目/团队特有的约定或流程写进 `.claude/skills/` 下的 SKILL.md，需要时用 `/skill-name` 调用，不必塞进 CLAUDE.md。
- **Subagents**：在单独上下文中跑，适合「读很多文件做调查」或「专门做安全审查」——探索和审查不会占满主对话的 context。
- **MCP**：连数据库、Figma、工单系统等，让 Claude 直接查数据、看设计、拉需求。

一句话：**通用、每次对话都要的放 CLAUDE.md；按场景用的放 Skills；重调查、重阅读的交给 Subagents；要连外部系统就用 MCP。**

---

## 八、会话管理：早纠偏、勤清上下文

对话是持久且可回滚的，可以大胆试，但要会「刹车」和「重启」。

- **Esc**：中途停掉当前操作，上下文还在，可以立刻改指令。
- **Esc 两次 或 /rewind**：回到之前的对话/代码状态，只恢复对话、只恢复代码或一起恢复都可以。
- 直接说「撤销刚才的修改」让 Claude 回退。
- **/clear**：任务之间清空上下文，避免无关内容把窗口塞满。

如果同一个问题你已经纠正 Claude 两次以上，往往说明上下文被失败尝试「污染」了。这时更适合 `/clear` 后重开一段对话，用更精确的提示（把你已经学到的约束写进去）再试。**干净会话 + 好提示，通常比在长会话里反复纠错更高效。**

---

## 九、避免几种常见失败模式

官方文档里总结了几类高频问题，可以对照自检：

- **厨房水槽式会话**：一个任务里掺进很多无关问题，上下文堆满杂讯。  
  **应对**：不相关的任务之间用 `/clear` 隔开。

- **反复纠正同一点**：错了改、改了又错，失败路径占满上下文。  
  **应对**：纠正超过两次就 `/clear`，写一条更具体的初始提示再开新会话。

- **CLAUDE.md 写得太长**：规则太多，重点反而不突出。  
  **应对**：狠心删；若某条规则必须被遵守，考虑改成 hook 或 Skill，让执行更确定。

- **只信不验**：实现看起来合理，但没跑测试、没检查边界。  
  **应对**：尽量给出可验证方式（测试、脚本、截图）；无法验证就别轻易发布。

- **无限探索**：让 Claude「查一下某某」却不限定范围，它可能读几百个文件。  
  **应对**：把调查范围收窄，或交给 subagent，把探索隔离在副上下文里。

---

## 十、心法不是铁律，直觉需要自己养

上述都是「多数情况下好用」的起点，不是每件事都要照做。有时你需要长会话里累积的历史，有时任务足够小可以跳过规划，有时故意提得模糊一点，反而能看出 Claude 如何理解问题。

重要的是：**留意什么有效、什么无效。** 当结果很好时，想想是提示结构、给的上下文还是当前模式在起作用；当结果不好时，问一句：是上下文太吵、提示太模糊，还是一次塞的任务太大？  
时间久了，你会形成自己的直觉——什么时候要具体、什么时候可以开放，什么时候先规划、什么时候先探索，什么时候清上下文、什么时候保留。这些，是任何一篇最佳实践文章都替代不了的。

---

## 拓展阅读

- [Claude Code 官方文档 - 最佳实践](https://code.claude.com/docs/zh-CN/best-practices)
- [Claude Code 如何工作](https://code.claude.com/docs/zh-CN/how-claude-code-works)
- [减少 token 使用](https://code.claude.com/docs/zh-CN/costs#reduce-token-usage)

---

*本文基于 code.claude.com 官方最佳实践文档整理，由 Claude Code 协作完成。*
